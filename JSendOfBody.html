<script src=" https://unpkg.com/@joergdietrich/leaflet.terminator@1.0.0/L.Terminator.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
<script src="https://unpkg.com/ionicons@4.3.0/dist/ionicons.js"></script>
<script src="icons/leaflet.awesome-markers.js"></script>
<script type="text/javascript">

// Written by Chris Gault chrisgault@gmail.com
// Please see https://github.com/nitro999/vrs-overlays for latest version

    if(VRS && VRS.globalDispatch && VRS.serverConfig) {
        VRS.globalDispatch.hook(VRS.globalEvent.bootstrapCreated, function(bootStrap) {
            if(bootStrap.hookMapInitialised) {
                bootStrap.hookMapInitialised(function(pageSettings) {
                    if(pageSettings.mapPlugin && pageSettings.mapPlugin.getNativeType() === 'OpenStreetMap') {
                        var map = pageSettings.mapPlugin.getNative();


    // Add day night overlay

    		var dayNight = L.terminator();

 
    // Add NASA Earth at Night

//    var NASAGIBS_ViirsEarthAtNight2012 = L.tileLayer('https://map1.vis.earthdata.nasa.gov/wmts-webmerc/VIIRS_CityLights_2012/default/{time}/{tilematrixset}{maxZoom}/{z}/{y}/{x}.{format}', {
//      attribution: 'Imagery provided by services from the Global Imagery Browse Services (GIBS), operated by the NASA/GSFC/Earth Science Data and Information System (<a href="https://earthdata.nasa.gov">ESDIS</a>) with funding provided by NASA/HQ.',
//      bounds: [[-85.0511287776, -179.999999975], [85.0511287776, 179.999999975]],
//      minZoom: 1,
//      maxZoom: 8,
//      format: 'jpg',
//      time: '',
//      tilematrixset: 'GoogleMapsCompatible_Level'
//    });

    // Add current NASA Sattelite

    var d = new Date();
    var curr_date = d.getDate()-1;
    var curr_month = d.getMonth()+1;
    var curr_year = d.getFullYear();
    if(curr_date<10){curr_date='0'+curr_date};
    if(curr_month<10){curr_month='0'+curr_month};
    var time = (curr_year + "-" + curr_month + "-" + curr_date);

//    var nasaSat = L.tileLayer('https://map1a.vis.earthdata.nasa.gov/wmts-webmerc/VIIRS_SNPP_CorrectedReflectance_TrueColor/default/' + time + '/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg', {
//      maxZoom: 18,
//      id: 'satelite',
//      attribution: "NASA"
//    });

var nasaSat = L.tileLayer('//gibs-{s}.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/' + time + '/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg', {
    maxZoom: 9,
    tileSize: 256,
    subdomains: 'abc',
    noWrap: true,
    continuousWorld: true,
    transparent: true,
    opacity: 0.3,
    // Prevent Leaflet from retrieving non-existent tiles on the
    // borders.
    bounds: [
      [-85.0511287776, -179.999999975],
      [85.0511287776, 179.999999975]
    ],
    attribution:
      '<a href="https://wiki.earthdata.nasa.gov/display/GIBS">' +
      'NASA EOSDIS GIBS</a>&nbsp;&nbsp;&nbsp;' +
      '<a href="https://github.com/nasa-gibs/web-examples/blob/master/examples/leaflet/webmercator-epsg3857.js">' +
      'View Source' +
      '</a>'
  });



    var nexRad = L.tileLayer('https://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/nexrad-n0q-900913/{z}/{x}/{y}.png?_='+ time, {
            maxZoom: 18,
            id: 'NexRad1',
            attribution: 'Mesonet.IAState.edu',
            transparent: true,
    		opacity: 0.3,
            });

    // Define menu items

    var groupedOverlays = {
        "Additional Layers": {
        "NexRad": nexRad,
        "Satellite" : nasaSat,
        "Daylight and Night" : dayNight
        },
    //    "Other cool stuff": {
    //    "NASA Earth at night": NASAGIBS_ViirsEarthAtNight2012
    //    }
    };

    // Add layers and overlay menu to OSM map

    L.control.groupedLayers(null, groupedOverlays).addTo(map);

                    }
                });
            }
        });
    }
    </script>
